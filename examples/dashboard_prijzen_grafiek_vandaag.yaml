# ==============================================================================
# ðŸ“Š ApexCharts Dashboard: Stroomprijs Vandaag (24 uur)
# ==============================================================================
#
# INSTALLATIE:
# 1. Installeer "ApexCharts Card" via HACS
# 2. Vervang "JOUW_ADRES" met je sensor naam (bijv. "maanstraat_17")
# 3. Kopieer deze code naar je dashboard
#
# BELANGRIJK:
# - Gebruikt price_info_summary.today_all attributen
# - Geen history data nodig (realtime attribute data)
# - Toont alleen vandaag (00:00 - 23:45)
#
# ==============================================================================

type: custom:apexcharts-card
header:
  show: true
  title: ðŸ“Š Stroomprijs Vandaag (Verbruik incl. BTW)
  show_states: true
  colorize_states: true
graph_span: 24h
span:
  start: day
all_series_config:
  stroke_width: 3
  curve: stepline
  type: line
series:
  # VANDAAG PRIJZEN
  - entity: sensor.tibber_pulse_JOUW_ADRES_electricity_price_total_incl_vat
    name: ðŸ”Œ Stroomprijs
    color: blue
    float_precision: 4
    extend_to: end
    show:
      extremas: true
      legend_value: true
      in_header: true
    data_generator: |
      const today = entity.attributes.price_info_summary.today_all || [];
      return today.map((entry) => {
        return [new Date(entry.startsAt).getTime(), entry.total];
      });
  
  # LAAGSTE PRIJS REFERENTIE (VANDAAG)
  - entity: sensor.tibber_pulse_JOUW_ADRES_electricity_price_total_incl_vat
    name: â¬‡ï¸ Laagste prijs
    color: green
    opacity: 0.6
    stroke_width: 2
    float_precision: 4
    show:
      legend_value: true
      in_header: true
      in_chart: true
      extremas: time
    data_generator: |
      const today = entity.attributes.price_info_summary.today_all || [];
      const now = new Date().getTime();
      // Filter alleen verleden + huidige tijd
      const past = today.filter(entry => new Date(entry.startsAt).getTime() <= now);
      // Bereken MIN alleen van verleden data
      const min = Math.min(...past.map(e => e.total));
      return past.map((entry) => {
        return [new Date(entry.startsAt).getTime(), min];
      });
  
  # HOOGSTE PRIJS REFERENTIE (VANDAAG)
  - entity: sensor.tibber_pulse_JOUW_ADRES_electricity_price_total_incl_vat
    name: â¬†ï¸ Hoogste prijs
    color: red
    opacity: 0.6
    stroke_width: 2
    float_precision: 4
    show:
      legend_value: true
      in_header: true
      in_chart: true
      extremas: time
    data_generator: |
      const today = entity.attributes.price_info_summary.today_all || [];
      const now = new Date().getTime();
      // Filter alleen verleden + huidige tijd
      const past = today.filter(entry => new Date(entry.startsAt).getTime() <= now);
      // Bereken MAX alleen van verleden data
      const max = Math.max(...past.map(e => e.total));
      return past.map((entry) => {
        return [new Date(entry.startsAt).getTime(), max];
      });

yaxis:
  - decimals: 4
    apex_config:
      title:
        text: Prijs (EUR/kWh)

apex_config:
  chart:
    height: 400
  annotations:
    xaxis:
      - x: |
          EVAL:new Date().getTime()
        strokeDashArray: 4
        borderColor: '#FF0000'
        label:
          borderColor: '#FF0000'
          style:
            color: '#fff'
            background: '#FF0000'
          text: 'Nu'
  tooltip:
    enabled: true
    x:
      format: dd MMM HH:mm
  legend:
    show: true
    position: bottom